name: prepare-ios-build
description: Action to prepare environment for ios build

runs:
  using: composite
  steps:
    - name: ci/install-os-deps
      env:
        HOMEBREW_NO_AUTO_UPDATE: "1"
      shell: bash
      run: |
        echo "::group::install-os-deps"
        echo "### Running brew update"
        brew update
        brew uninstall python@3.11
        brew upgrade
        #echo "### Checking out specific homebrew/core tap version"
        #git -C $(brew --repository)/Library/Taps/homebrew/homebrew-core/ checkout c0c26c4e33875733cb694a075ba3e408400ee398
        echo "### Installing watchman"
        #brew install $(brew --repository)/Library/Taps/homebrew/homebrew-core/Formula/w/watchman.rb
        brew install watchman
        echo "::endgroup::"

    - name: ci/prepare-mobile-build
      uses: ./.github/actions/prepare-mobile-build

    - name: ci/install-pods-dependencies
      shell: bash
      run: |
        echo "::group::install-pods-dependencies"
        npm run ios-gems
        npm run pod-install
        echo "::endgroup::"
